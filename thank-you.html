<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Thank You | MagnaMoney</title>

  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700;900&display=swap" rel="stylesheet">

  <style>
    :root {
      --charcoal: #1C1C1C;
      --charcoal-panel: rgba(29,30,32,0.95);
      --panel-border: rgba(255,255,255,0.07);
      --text-main: #FFFFFF;
      --text-dim: rgba(255,255,255,0.8);
      --text-faint: rgba(255,255,255,0.6);
      --gold: #C6A76B;
      --gold-shadow: rgba(198,167,107,0.3);
      --max-width: 900px;
      --radius-lg: 12px;
    }

    * { box-sizing:border-box; }

    body {
      margin:0;
      background:var(--charcoal);
      font-family:"Lato", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color:var(--text-main);
      padding:24px;
      display:flex;
      justify-content:center;
    }

    .page-wrap { width:100%; max-width:var(--max-width); }
    .panel {
      background:linear-gradient(180deg, rgba(29,30,32,0.95), rgba(29,30,32,0.9));
      border-radius:var(--radius-lg);
      border:1px solid var(--panel-border);
      box-shadow:0 16px 40px rgba(0,0,0,0.6);
      padding:32px 24px 32px;
      text-align:center;
    }

    .logo-wrap { display:inline-flex; flex-direction:column; align-items:center; justify-content:center; margin-bottom:16px; }
    .crown-logo { width:72px; height:72px; background-size:contain; background-repeat:no-repeat; background-position:center; background-image:url("https://magna-money-enquiry-form.neocities.org/Magna%20Money%20logo_full_colour.png"); filter:drop-shadow(0 4px 12px var(--gold-shadow)); }
    .brand-name { color:var(--text-main); font-weight:700; font-size:18px; line-height:1.2; letter-spacing:0.05em; margin-top:12px; text-transform:uppercase; }
    .brand-tag { color:var(--gold); font-size:13px; font-weight:400; margin-top:6px; text-align:center; max-width:540px; }

    .thanks-headline { font-size:20px; font-weight:700; color:var(--gold); line-height:1.3; margin:24px 0 12px; }
    .thanks-body { color:var(--text-dim); font-size:15px; font-weight:300; line-height:1.5; max-width:620px; margin:0 auto 18px; }

    .progress-wrap { max-width:440px; margin:18px auto 10px; text-align:left; }
    .progress-bar { width:100%; height:12px; background: rgba(255,255,255,0.06); border-radius:8px; overflow:hidden; border:1px solid rgba(255,255,255,0.04); }
    .progress-fill { height:100%; width:0%; background: linear-gradient(90deg, var(--gold), rgba(198,167,107,0.85)); box-shadow:0 6px 18px rgba(198,167,107,0.08); transition:width 0.2s linear; }

    .countdown { color:var(--text-dim); font-size:13px; margin-top:8px; text-align:center; }

    .contact-block { margin-top:16px; font-size:14px; line-height:1.5; color:var(--text-main); font-weight:400; }
    .footer-line { margin-top:24px; font-size:13px; line-height:1.4; color:var(--text-faint); }

    .prefill-note { margin-top:10px; font-size:13px; color:var(--text-dim); }
    .details { margin-top:10px; font-size:14px; color:var(--text-main); }

    .btn-inline { display:inline-block; margin-top:12px; background:var(--gold); color:var(--charcoal); padding:10px 18px; border-radius:8px; font-weight:700; text-decoration:none; cursor:pointer; }

    @media (max-width:640px){ .thanks-headline{ font-size:18px; } .thanks-body{ font-size:14px; } }
  </style>
</head>
<body>
  <div class="page-wrap">
    <div class="panel" id="panelRoot" role="main" aria-live="polite">
      <div class="logo-wrap" aria-hidden="true">
        <div class="crown-logo"></div>
        <div class="brand-name">MAGNAMONEY</div>
        <div class="brand-tag">The Commercial Finance Boutique – Bespoke, Collaborative &amp; Expert Funding Advisory</div>
      </div>

      <div class="thanks-headline">Thank you — we've received your information</div>

      <div class="thanks-body">
        Your details have been submitted securely. I’ll review everything and come back to you quickly with next steps.
      </div>

      <div class="progress-wrap" aria-hidden="false">
        <div class="progress-bar" aria-hidden="true"><div id="progressFill" class="progress-fill"></div></div>
        <div id="countdownText" class="countdown">Redirecting to book a time in <strong id="countNum">8</strong> seconds…</div>
      </div>

      <div id="prefillNote" class="prefill-note" style="display:none"></div>
      <div id="prefillDetails" class="details" style="display:none"></div>

      <div style="margin-top:14px">
        <a id="goNow" class="btn-inline" role="button">Book now / go to calendar</a>
      </div>

      <div class="contact-block" style="margin-top:18px">
        <div><strong>Questions right now?</strong></div>
        <div>Speak directly with Andrew Crutchley</div>
        <div>07377&nbsp;018&nbsp;238</div>
        <div>andrew.crutchley@magnamoney.co.uk</div>
        <div>www.magnamoney.co.uk</div>
      </div>

      <div class="footer-line">Magna Money is a trading style of Sedulo Funding Solutions Ltd (10276541).</div>
    </div>
  </div>

  <script>
    // --------------- CONFIG - update only these if you want a different endpoint / meeting link ---------------
    // Apps Script exec URL (used for JSONP prefill lookup when ?sid= is present)
    const SCRIPT_EXEC_URL = 'https://script.google.com/macros/s/AKfycby8Zv4WLTcElTcQjKHVcVORIQ8m5t5-5OXpJkxMuA0O6E8DCAV2iQIbqwHF6OwfvpFB/exec';

    // Default HubSpot meetings URL (will be used if no prefill mapping is available)
    const HUBSPOT_MEETINGS = 'https://meetings.hubspot.com/andrew-crutchley?uuid=aded191f-6b81-472b-ba9a-c77a1b41487e';
    // --------------------------------------------------------------------------------------------------------

    // Utility: get query params
    function getQueryParams() {
      const q = {};
      const raw = location.search.replace(/^\?/, '');
      if (!raw) return q;
      raw.split('&').forEach(part => {
        const [k,v] = part.split('=');
        if (!k) return;
        q[decodeURIComponent(k)] = v ? decodeURIComponent(v.replace(/\+/g,' ')) : '';
      });
      return q;
    }

    // Extract query params from a full URL
    function extractParamsFromUrl(url){
      try {
        const u = new URL(url);
        const obj = {};
        for (const [k,v] of u.searchParams.entries()) obj[k] = v;
        return obj;
      } catch(e) {
        // fallback simple parse
        const idx = url.indexOf('?');
        if (idx < 0) return {};
        const qs = url.substr(idx+1);
        const out = {};
        qs.split('&').forEach(p => {
          const [k,v] = p.split('=');
          if (!k) return;
          out[decodeURIComponent(k)] = v ? decodeURIComponent(v) : '';
        });
        return out;
      }
    }

    // Update UI with any available name/email details
    function showPrefillDetails(first, last, email){
      const note = document.getElementById('prefillNote');
      const details = document.getElementById('prefillDetails');
      if (first || last || email){
        note.style.display = 'block';
        note.textContent = 'We will try to pre-fill your booking page with the details you provided.';
        details.style.display = 'block';
        details.innerHTML = '<strong>Your booking details</strong><div style="margin-top:6px">' +
                            (first ? ('First name: ' + escapeHtml(first) + '<br/>') : '') +
                            (last  ? ('Surname: ' + escapeHtml(last) + '<br/>') : '') +
                            (email ? ('Email: ' + escapeHtml(email) + '<br/>') : '') +
                            '</div>';
      }
    }

    // Safe HTML escape
    function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]; }); }

    // Primary redirect target (default)
    let redirectTarget = HUBSPOT_MEETINGS;

    // Attempt to fetch prefill mapping from Apps Script if sid present (JSONP)
    (function initPrefill(){
      const q = getQueryParams();
      // If the form-provided fields are provided directly via query params (rare), show them
      if (q.firstname || q.lastname || q.email) {
        showPrefillDetails(q.firstname, q.lastname, q.email);
      }

      // If script wrote a mapping and redirected with ?sid=..., use JSONP to fetch prefillUrl
      if (q.sid) {
        // JSONP callback name
        const cbName = 'magnaPrefillCB_' + (new Date()).getTime();
        window[cbName] = function(result){
          try {
            if (result && result.prefillUrl){
              // If we have a stored prefill URL, use it as redirect target and extract names to show
              redirectTarget = result.prefillUrl;
              const p = extractParamsFromUrl(result.prefillUrl);
              showPrefillDetails(p.firstname || p.firstname || p.first || p.first_name || '', p.lastname || p.last || p.surname || '', p.email || '');
              // update the "Book now" link href
              setBookNowLink(redirectTarget);
            }
          } catch(e){
            // ignore
          } finally {
            // cleanup script tag and callback
            try { delete window[cbName]; }catch(e){}
            const s = document.getElementById(cbName + '_s'); if (s) s.remove();
          }
        };
        // inject script tag for JSONP
        const script = document.createElement('script');
        script.src = SCRIPT_EXEC_URL + '?sid=' + encodeURIComponent(q.sid) + '&callback=' + cbName;
        script.id = cbName + '_s';
        script.onerror = function(){ try{ delete window[cbName]; }catch(e){} };
        document.head.appendChild(script);
      } else {
        // No sid; keep redirectTarget as default (HUBSPOT_MEETINGS)
        setBookNowLink(redirectTarget);
      }
    })();

    // Set the immediate book link
    function setBookNowLink(url){
      const go = document.getElementById('goNow');
      go.setAttribute('href', url);
      go.setAttribute('role','link');
      go.onclick = function(e){ e.preventDefault(); window.location.href = url; };
    }

    // Countdown + progress logic
    (function startCountdown(){
      const total = 8;
      let remaining = total;
      const fill = document.getElementById('progressFill');
      const num = document.getElementById('countNum');
      const text = document.getElementById('countdownText');

      // ensure goNow link has href set (may be updated later by JSONP)
      setBookNowLink(redirectTarget);

      const tick = ()=>{
        const pct = Math.round(((total - remaining) / total) * 100);
        if (fill) fill.style.width = pct + '%';
        if (num) num.textContent = remaining;
        if (remaining <= 0){
          if (fill) fill.style.width = '100%';
          // final redirect (use latest redirectTarget)
          try { window.location.href = redirectTarget; } catch(e){}
          return;
        }
        remaining--;
        setTimeout(tick, 1000);
      };
      // Allow user to click anywhere on panel to go immediately
      document.getElementById('panelRoot').addEventListener('click', function(){ window.location.href = redirectTarget; });
      // Start countdown
      tick();
    })();

  </script>
</body>
</html>
