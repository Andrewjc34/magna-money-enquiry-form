<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Thank You | MagnaMoney</title>

  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700;900&display=swap" rel="stylesheet">

  <style>
    :root {
      --charcoal: #1C1C1C;
      --charcoal-panel: rgba(29,30,32,0.95);
      --panel-border: rgba(255,255,255,0.07);
      --text-main: #FFFFFF;
      --text-dim: rgba(255,255,255,0.8);
      --text-faint: rgba(255,255,255,0.6);
      --gold: #C6A76B;
      --gold-shadow: rgba(198,167,107,0.3);
      --max-width: 900px;
      --radius-lg: 12px;
    }

    * { box-sizing:border-box; }

    body {
      margin:0;
      background:var(--charcoal);
      font-family:"Lato", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color:var(--text-main);
      padding:24px;
      display:flex;
      justify-content:center;
    }

    .page-wrap { width:100%; max-width:var(--max-width); }
    .panel {
      background:linear-gradient(180deg, rgba(29,30,32,0.95), rgba(29,30,32,0.9));
      border-radius:var(--radius-lg);
      border:1px solid var(--panel-border);
      box-shadow:0 16px 40px rgba(0,0,0,0.6);
      padding:32px 24px 32px;
      text-align:center;
    }

    .logo-wrap { display:inline-flex; flex-direction:column; align-items:center; justify-content:center; margin-bottom:16px; }
    .crown-logo { width:72px; height:72px; background-size:contain; background-repeat:no-repeat; background-position:center; background-image:url("https://magna-money-enquiry-form.neocities.org/Magna%20Money%20logo_full_colour.png"); filter:drop-shadow(0 4px 12px var(--gold-shadow)); }
    .brand-name { color:var(--text-main); font-weight:700; font-size:18px; line-height:1.2; letter-spacing:0.05em; margin-top:12px; text-transform:uppercase; }
    .brand-tag { color:var(--gold); font-size:13px; font-weight:400; margin-top:6px; text-align:center; max-width:540px; }

    .thanks-headline { font-size:20px; font-weight:700; color:var(--gold); line-height:1.3; margin:24px 0 12px; }
    .thanks-body { color:var(--text-dim); font-size:15px; font-weight:300; line-height:1.5; max-width:620px; margin:0 auto 18px; }

    .progress-wrap { max-width:440px; margin:18px auto 10px; text-align:left; }
    .progress-bar { width:100%; height:12px; background: rgba(255,255,255,0.06); border-radius:8px; overflow:hidden; border:1px solid rgba(255,255,255,0.04); }
    .progress-fill { height:100%; width:0%; background: linear-gradient(90deg, var(--gold), rgba(198,167,107,0.85)); box-shadow:0 6px 18px rgba(198,167,107,0.08); transition:width 0.2s linear; }

    .countdown { color:var(--text-dim); font-size:13px; margin-top:8px; text-align:center; }

    .contact-block { margin-top:16px; font-size:14px; line-height:1.5; color:var(--text-main); font-weight:400; }
    .footer-line { margin-top:24px; font-size:13px; line-height:1.4; color:var(--text-faint); }

    @media (max-width:640px){ .thanks-headline{ font-size:18px; } .thanks-body{ font-size:14px; } }
  </style>
</head>
<body>
  <div class="page-wrap">
    <div class="panel">
      <div class="logo-wrap">
        <div class="crown-logo" aria-hidden="true"></div>
        <div class="brand-name">MAGNAMONEY</div>
        <div class="brand-tag">The Commercial Finance Boutique – Bespoke, Collaborative &amp; Expert Funding Advisory</div>
      </div>

      <div class="thanks-headline">Thank you — we've received your information</div>

      <div class="thanks-body">
        Your details have been submitted securely. I’ll review everything and come back to you quickly with next steps.
      </div>

      <div class="progress-wrap">
        <div class="progress-bar" aria-hidden="true"><div id="progressFill" class="progress-fill"></div></div>
        <div id="countdownText" class="countdown">Redirecting to book a time in <strong>8</strong> seconds…</div>
      </div>

      <div class="contact-block">
        <div><strong>Questions right now?</strong></div>
        <div>Speak directly with Andrew Crutchley</div>
        <div>07377&nbsp;018&nbsp;238</div>
        <div>andrew.crutchley@magnamoney.co.uk</div>
        <div>www.magnamoney.co.uk</div>
      </div>

      <div class="footer-line">Magna Money is a trading style of Sedulo Funding Solutions Ltd (10276541).</div>
    </div>
  </div>

 <script>
  // CONFIG
  const SCRIPT_EXEC_URL = 'https://script.google.com/macros/s/AKfycbwWlXvC_Oh88e5XqtCPrRLHexZrpzXqDcaPi4nLVkasv0DlNmNy3Je_bQaIE8IJPxT1/exec';
  const HUBSPOT_MEETINGS = 'https://meetings.hubspot.com/andrew-crutchley';

  // helper: read query param
  function getParam(name){
    try { return (new URL(location.href)).searchParams.get(name); } catch(e) { return null; }
  }

  // create a visible manual link under the progress area
  (function addManualLink(){
    const panel = document.querySelector('.panel');
    if (!panel) return;
    const container = document.createElement('div');
    container.style.marginTop = '14px';
    container.style.fontSize = '13px';
    container.innerHTML = '<div style="color:#fff"><a id="manualLink" style="color:var(--gold); text-decoration:none; font-weight:600;" href="#">CLICK HERE TO BOOK NOW</a></div>';
    panel.appendChild(container);
    // click handler added below after prefill resolution
  })();

  // JSONP callback (Apps Script will call this)
  window.__magna_prefill_cb = function(payload){
    try {
      if (payload && payload.prefillUrl) {
        window.__magna_prefill_cb.prefillUrl = payload.prefillUrl;
        console.log('Prefill URL received:', payload.prefillUrl);
      } else {
        console.log('No prefill URL returned for sid.');
      }
    } catch (e) { console.warn(e); }
  };

  (function(){
    const total = 8;
    let remaining = total;
    const fill = document.getElementById('progressFill');
    const text = document.getElementById('countdownText');
    const sid = getParam('sid');
    let prefillUrl = null;

    // request prefill via JSONP if we have a sid
    if (sid && SCRIPT_EXEC_URL){
      try {
        const script = document.createElement('script');
        // JSONP call: Apps Script doGet supports callback param
        script.src = SCRIPT_EXEC_URL + '?sid=' + encodeURIComponent(sid) + '&callback=__magna_prefill_cb';
        script.onerror = function(){ console.warn('JSONP load error'); };
        document.body.appendChild(script);
        // small safety: after 3s try to pick up prefill if callback already fired
        setTimeout(()=> { prefillUrl = window.__magna_prefill_cb && window.__magna_prefill_cb.prefillUrl; }, 1200);
      } catch (e) {
        console.warn('Prefill JSONP error', e);
      }
    }

    // tick function
    const tick = ()=>{
      const pct = Math.round(((total - remaining) / total) * 100);
      if (fill) fill.style.width = pct + '%';
      if (text) text.innerHTML = 'Redirecting to book a time in <strong>' + remaining + '</strong> second' + (remaining === 1 ? '' : 's') + '…';
      if (remaining <= 0){
        if (fill) fill.style.width = '100%';
        // final redirect: prefer prefillUrl if available (fresh check)
        prefillUrl = prefillUrl || (window.__magna_prefill_cb && window.__magna_prefill_cb.prefillUrl) || null;
        const target = prefillUrl || HUBSPOT_MEETINGS;
        window.location.href = target;
        return;
      }
      remaining--;
      setTimeout(tick, 1000);
    };

    // manual link click handler
    const manualClick = (e)=>{
      e && e.preventDefault();
      // use prefill if present
      const target = (window.__magna_prefill_cb && window.__magna_prefill_cb.prefillUrl) || HUBSPOT_MEETINGS;
      window.location.href = target;
    };

    // attach manual handler
    const manualEl = document.getElementById('manualLink');
    if (manualEl) manualEl.addEventListener('click', manualClick);
    // also keep body click-to-skip behaviour
    document.body.addEventListener('click', ()=> {
      // avoid immediately firing when the user clicks form controls — only jump if they click empty space or the manual link
      // if they click the manual link the handler above will run first
      const target = (window.__magna_prefill_cb && window.__magna_prefill_cb.prefillUrl) || HUBSPOT_MEETINGS;
      window.location.href = target;
    });

    // start countdown
    tick();
  })();
</script>

</body>
</html>